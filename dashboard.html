<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Mission Control</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
  <!-- Background (SVG 2D, discreto) -->
  <div class="bg-orbit" aria-hidden="true">
    <svg viewBox="0 0 900 600" preserveAspectRatio="xMidYMid slice">
      <defs>
        <radialGradient id="glow" cx="50%" cy="45%" r="70%">
          <stop offset="0%" stop-opacity="0.22"/>
          <stop offset="60%" stop-opacity="0.05"/>
          <stop offset="100%" stop-opacity="0"/>
        </radialGradient>
        <filter id="softGlow">
          <feGaussianBlur stdDeviation="2.2" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <rect width="900" height="600" fill="url(#glow)"></rect>

      <!-- Soft orbit lines (background only) -->
      <path d="M 120 330 C 280 70, 620 70, 780 330 C 620 590, 280 590, 120 330 Z"
            fill="none" stroke="rgba(120,170,255,0.12)" stroke-width="2"/>
      <path d="M 200 330 C 320 150, 580 150, 700 330 C 580 510, 320 510, 200 330 Z"
            fill="none" stroke="rgba(120,170,255,0.08)" stroke-width="2"/>

      <!-- Trajectory arc (static) -->
      <path d="M 520 440 C 640 260, 780 230, 880 330"
            fill="none" stroke="rgba(120,170,255,0.18)" stroke-width="3"/>

      <!-- Rocket static on the right (we'll micro-shake with CSS vars) -->
      <g filter="url(#softGlow)">
        <g id="rocketStatic" opacity="0.55" transform="translate(820,300)">
          <path d="M0,-26 C14,-22 14,22 0,26 C-14,22 -14,-22 0,-26 Z" fill="rgba(210,230,255,0.85)"/>
          <path d="M0,-36 L14,-16 L0,-22 L-14,-16 Z" fill="rgba(160,200,255,0.7)"/>
          <path d="M-14,14 L-34,28 L-10,8 Z" fill="rgba(120,170,255,0.45)"/>
          <path d="M14,14 L34,28 L10,8 Z" fill="rgba(120,170,255,0.45)"/>
          <circle cx="0" cy="-3" r="4.4" fill="rgba(10,25,45,0.9)"/>
          <path d="M0,26 C8,31 8,40 0,50 C-8,40 -8,31 0,26 Z" fill="rgba(120,220,255,0.30)"/>
        </g>
      </g>

      <!-- Some stars -->
      <g opacity="0.22">
        <circle cx="110" cy="120" r="1.4" fill="white"/>
        <circle cx="220" cy="80" r="1.1" fill="white"/>
        <circle cx="790" cy="140" r="1.6" fill="white"/>
        <circle cx="700" cy="90" r="1.0" fill="white"/>
        <circle cx="820" cy="330" r="1.2" fill="white"/>
        <circle cx="120" cy="420" r="1.0" fill="white"/>
        <circle cx="260" cy="520" r="1.5" fill="white"/>
        <circle cx="640" cy="520" r="1.2" fill="white"/>
      </g>
    </svg>
  </div>

  <div class="shell">
    <header class="topbar">
      <div class="brand">
        <div class="mark"></div>
        <div>
          <div class="title">Mini Mission Control</div>
          <div class="subtitle">localhost telemetry</div>
        </div>
      </div>

      <div class="statusbar">
        <div class="pill" id="connPill">
          <span class="dot" id="connDot"></span>
          <span id="connText">CONNECTING</span>
        </div>
        <div class="pill subtle">
          <span class="muted">Last pkt</span>
          <span id="lastPkt">—</span>
        </div>
      </div>
    </header>

    <main class="grid">
      <!-- Left: Metrics -->
      <section class="panel">
        <div class="panelHead">
          <h2>Telemetry</h2>
          <div class="small muted">Aggiornamento ~300ms</div>
        </div>

        <div class="cards">
          <div class="card">
            <div class="cardLabel">Pressure</div>
            <div class="cardValue"><span id="pressure">—</span> <span class="unit">bar</span></div>
            <div class="cardFoot muted">Nominal: 8.0 ± 0.3</div>
          </div>

          <div class="card">
            <div class="cardLabel">Vibration</div>
            <div class="cardValue"><span id="vib">—</span> <span class="unit">g</span></div>
            <div class="cardFoot muted">Nominal: 0.8 ± 0.2</div>
          </div>

          <div class="card span2">
            <div class="cardLabel">Status</div>
            <div class="statusBig" id="status">INIT</div>
            <div class="statusHint muted" id="statusHint">Waiting for telemetry…</div>
          </div>
        </div>

        <div class="gaugeWrap">
          <div class="gaugeCard">
            <div class="gaugeTitle">
              <div>
                <div class="gaugeName">Temperature</div>
                <div class="muted small">tachometer</div>
              </div>
              <div class="tempRead">
                <span id="temp">—</span><span class="unit">°C</span>
              </div>
            </div>

            <!-- Gauge -->
            <svg class="gauge" viewBox="0 0 240 140">
              <path class="gaugeTrack" d="M20,120 A100,100 0 0,1 220,120" />
              <path class="gaugeFill" id="gaugeFill" d="M20,120 A100,100 0 0,1 220,120" pathLength="100"/>
              <!-- Start left (180°). JS will rotate correctly. -->
              <g class="gaugeNeedle" id="needle" transform="translate(120,120) rotate(180)">
                <line x1="0" y1="0" x2="78" y2="0"></line>
                <circle cx="0" cy="0" r="5"></circle>
              </g>
              <text x="20" y="132" class="gaugeText">0</text>
              <text x="210" y="132" class="gaugeText">120</text>
            </svg>

            <div class="gaugeLegend">
              <span class="tag ok">OK</span>
              <span class="tag warn">WARN</span>
              <span class="tag bad">FAULT</span>
            </div>
          </div>

          <div class="chartCard">
            <div class="chartHead">
              <div>
                <div class="chartTitle">Live Chart</div>
                <div class="muted small">Temp + Pressure (last ~60s)</div>
              </div>
              <div class="chartLegend">
                <span class="lg temp"></span><span class="muted small">Temp</span>
                <span class="lg press"></span><span class="muted small">Press</span>
              </div>
            </div>
            <canvas id="chart" width="900" height="360"></canvas>
          </div>
        </div>
      </section>

      <!-- Right: Controls + Events -->
      <aside class="panel side">
        <div class="panelHead">
          <h2>Controls</h2>
          <div class="small muted">Fault injection</div>
        </div>

        <div class="btnRow">
          <button class="btn danger" id="btnFaultOn">Inject Fault</button>
          <button class="btn" id="btnFaultOff">Reset Fault</button>
        </div>

        <div class="miniInfo">
          <div class="kv">
            <span class="muted">Fault mode</span>
            <span id="faultMode">—</span>
          </div>
          <div class="kv">
            <span class="muted">Packets</span>
            <span id="pktCount">0</span>
          </div>
        </div>

        <div class="panelHead mt">
          <h2>Event log</h2>
          <div class="small muted">Ultimi 50</div>
        </div>

        <div class="log" id="log"></div>
      </aside>
    </main>

    <footer class="foot muted">
      Tip: Inject Fault → temp sale e lo status diventa OVERTEMP, Reset Fault → torna OK.  | by Luigi Serafino
    </footer>
  </div>

  <script src="/static/dashboard.js"></script>
</body>
</html>
